<!doctype html>
<html>
	<head>
		<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5S5WB7M');</script>
<!-- End Google Tag Manager -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Logistics Center of Gravity Analysis in Python</title>
		<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Logistics Center of Gravity Analysis in Python | Victor Angelo Blancada</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Logistics Center of Gravity Analysis in Python" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Victor Angelo Blancada is a data scientist, AI developer, and strategy consultant with proven experience in improving operational efficiency through predictive modeling and AI-powered automation." />
<meta property="og:description" content="Victor Angelo Blancada is a data scientist, AI developer, and strategy consultant with proven experience in improving operational efficiency through predictive modeling and AI-powered automation." />
<link rel="canonical" href="https://victorangeloblancada.github.io/blog/2020/09/07/center-of-gravity-analysis.html" />
<meta property="og:url" content="https://victorangeloblancada.github.io/blog/2020/09/07/center-of-gravity-analysis.html" />
<meta property="og:site_name" content="Victor Angelo Blancada" />
<meta property="og:image" content="https://victorangeloblancada.github.io/assets/images/truck.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-09-07T00:00:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://victorangeloblancada.github.io/assets/images/truck.jpg" />
<meta property="twitter:title" content="Logistics Center of Gravity Analysis in Python" />
<script type="application/ld+json">
{"url":"https://victorangeloblancada.github.io/blog/2020/09/07/center-of-gravity-analysis.html","image":"https://victorangeloblancada.github.io/assets/images/truck.jpg","headline":"Logistics Center of Gravity Analysis in Python","dateModified":"2020-09-07T00:00:00+08:00","datePublished":"2020-09-07T00:00:00+08:00","description":"Victor Angelo Blancada is a data scientist, AI developer, and strategy consultant with proven experience in improving operational efficiency through predictive modeling and AI-powered automation.","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://victorangeloblancada.github.io/blog/2020/09/07/center-of-gravity-analysis.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

		<link rel="stylesheet" href="https://indestructibletype.com/fonts/Jost.css" type="text/css" charset="utf-8" />

<link rel="stylesheet" href="/assets/css/styles.css">
<link rel="stylesheet" href="/assets/css/syntax.css">

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
	</head>
	<body>
		<script type="text/javascript">
  window.onscroll = function() {myScrollIndicator()};

  function myScrollIndicator() {
    var winScroll = document.body.scrollTop || document.documentElement.scrollTop;
    var height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
    var scrolled = (winScroll / height) * 100;
    document.getElementById("myBar").style.width = scrolled + "%";
  }
</script>

<div class="header">
  <div class="progress-container">
    <div class="progress-bar" id="myBar"></div>
  </div>
</div>
		<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5S5WB7M"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
		<div class="wrapper">
			<link rel="stylesheet" href="/assets/css/speech-input.css">
<script src="/assets/js/nav.js" type="text/javascript"></script>
<script src="/assets/js/speech-input.js" type="text/javascript"></script>
<div class="navbar transition" id="navbar">
	<nav>
		<a onClick="expand('navbar', 'search-input')">
			<svg width="50" height="50" aria-label="search" class="octicon octicon-search" viewBox="0 0 24 24" version="1.1" role="img"><path fill-rule="evenodd" d="M14.53 15.59a8.25 8.25 0 111.06-1.06l5.69 5.69a.75.75 0 11-1.06 1.06l-5.69-5.69zM2.5 9.25a6.75 6.75 0 1111.74 4.547.746.746 0 00-.443.442A6.75 6.75 0 012.5 9.25z"></path></svg>
			<p>Search</p>
		</a>
		
			<a href="/" >
				<svg width="50" height="50" aria-label="home" class="octicon octicon-home" viewBox="0 0 24 24" version="1.1" role="img"><path fill-rule="evenodd" d="M11.03 2.59a1.5 1.5 0 011.94 0l7.5 6.363a1.5 1.5 0 01.53 1.144V19.5a1.5 1.5 0 01-1.5 1.5h-5.75a.75.75 0 01-.75-.75V14h-2v6.25a.75.75 0 01-.75.75H4.5A1.5 1.5 0 013 19.5v-9.403c0-.44.194-.859.53-1.144l7.5-6.363zM12 3.734l-7.5 6.363V19.5h5v-6.25a.75.75 0 01.75-.75h3.5a.75.75 0 01.75.75v6.25h5v-9.403L12 3.734z"></path></svg>
				<p>Home</p>
			</a>
		
			<a href="/pages/about.html" >
				<svg width="50" height="50" aria-label="person" class="octicon octicon-person" viewBox="0 0 24 24" version="1.1" role="img"><path fill-rule="evenodd" d="M12 2.5a5.5 5.5 0 00-3.096 10.047 9.005 9.005 0 00-5.9 8.18.75.75 0 001.5.045 7.5 7.5 0 0114.993 0 .75.75 0 101.499-.044 9.005 9.005 0 00-5.9-8.181A5.5 5.5 0 0012 2.5zM8 8a4 4 0 118 0 4 4 0 01-8 0z"></path></svg>
				<p>About</p>
			</a>
		
			<a href="/blog.html" >
				<svg width="50" height="50" aria-label="book" class="octicon octicon-book" viewBox="0 0 24 24" version="1.1" role="img"><path fill-rule="evenodd" d="M0 3.75A.75.75 0 01.75 3h7.497c1.566 0 2.945.8 3.751 2.014A4.496 4.496 0 0115.75 3h7.5a.75.75 0 01.75.75v15.063a.75.75 0 01-.755.75l-7.682-.052a3 3 0 00-2.142.878l-.89.891a.75.75 0 01-1.061 0l-.902-.901a3 3 0 00-2.121-.879H.75a.75.75 0 01-.75-.75v-15zm11.247 3.747a3 3 0 00-3-2.997H1.5V18h6.947a4.5 4.5 0 012.803.98l-.003-11.483zm1.503 11.485V7.5a3 3 0 013-3h6.75v13.558l-6.927-.047a4.5 4.5 0 00-2.823.971z"></path></svg>
				<p>Blog</p>
			</a>
		
			<a href="/pages/resume-downloads.html" >
				<svg width="50" height="50" aria-label="file" class="octicon octicon-file" viewBox="0 0 24 24" version="1.1" role="img"><path fill-rule="evenodd" d="M5 2.5a.5.5 0 00-.5.5v18a.5.5 0 00.5.5h14a.5.5 0 00.5-.5V8.5h-4a2 2 0 01-2-2v-4H5zm10 0v4a.5.5 0 00.5.5h4a.5.5 0 00-.146-.336l-4.018-4.018A.5.5 0 0015 2.5zM3 3a2 2 0 012-2h9.982a2 2 0 011.414.586l4.018 4.018A2 2 0 0121 7.018V21a2 2 0 01-2 2H5a2 2 0 01-2-2V3z"></path></svg>
				<p>Résumé</p>
			</a>
		
	</nav>

	<!-- Html Elements for Search -->
	<div id="search-container" class="search-container">
		<center>
			<input type="text" id="search-input" class="speech-input" placeholder="Search this site" style="width: 100%;">
			<ol id="results-container"></ol>
		</center>
	</div>

	<!-- Script pointing to search.js -->
	<script src="/assets/js/search.js" type="text/javascript"></script>

	<!-- Configuration -->
	<script>
	SimpleJekyllSearch({
	  searchInput: document.getElementById('search-input'),
	  resultsContainer: document.getElementById('results-container'),
	  json: '/search.json'
	})
	</script>
</div>

</div>

			<div class="hero-img"  style="background-image: linear-gradient(rgba(0,0,0,.3), rgba(0,0,0,.3)), url( /assets/images/truck.jpg );"  >
				<div class="center-content">
					<span class="on-bg">
						<h1> Logistics Center of Gravity Analysis in Python </h1>
						<!--
						<p>07 Sep 2020</p>
						-->
						<a href="#start">
							<div style="-webkit-animation-name: pulse; -webkit-animation-duration: 2s; animation-name: pulse;animation-duration: 2s; animation-direction: alternate;">
								<!--<p>Reading time: 


  19 mins
</p>-->
								
								<p>September 07, 2020</p>
								
								<p>scroll for more</p>
								<svg width="50" height="50" fill="white" aria-label="down" class="octicon octicon-arrow-down" viewBox="0 0 24 24" version="1.1" role="img"><path fill-rule="evenodd" d="M4.97 13.22a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 10-1.06-1.06l-4.97 4.97V3.75a.75.75 0 00-1.5 0v14.44l-4.97-4.97a.75.75 0 00-1.06 0z"></path></svg>
							</div>
						</a>
						
						<div>
							

<style>
#share-buttons {display: inline-block; vertical-align: middle; }
#share-buttons:after {content: ""; display: block; clear: both;}
#share-buttons > div {
    position: relative;
    text-align: left; 
    height: 36px; 
    width: 32px; 
    float: left; 
    text-align: center;
}
#share-buttons > div > svg {height: 16px; fill: #FFF; margin-top: 10px;}
#share-buttons > div:hover {cursor: pointer;}
#share-buttons > div.facebook:hover > svg {fill: #3B5998;}
#share-buttons > div.twitter:hover > svg {fill: #55ACEE;}
#share-buttons > div.linkedin:hover > svg {fill: #0077b5;}
#share-buttons > div.pinterest:hover > svg {fill: #CB2027;}
#share-buttons > div.gplus:hover > svg {fill: #dd4b39;}
#share-buttons > div.mail:hover > svg {fill: #7D7D7D;}
#share-buttons > div.instagram:hover > svg {fill: #C73B92;}
#share-buttons > div.facebook > svg {height: 18px; margin-top: 9px;}
#share-buttons > div.twitter > svg {height: 20px; margin-top: 8px;}
#share-buttons > div.linkedin > svg {height: 19px; margin-top: 7px;}
#share-buttons > div.pinterest > svg {height: 20px; margin-top: 9px;}
#share-buttons > div.gplus > svg {height: 17px; margin-top: 9px; position: relative; left: 1px;}
#share-buttons > div.mail > svg {height: 14px; margin-top: 11px;}
</style>

<span>Share on: </span><div id="share-buttons">

    <div class="linkedin" title="Share this on Linkedin" onclick="window.open('https://www.linkedin.com/shareArticle?mini=true&url=https://victorangeloblancada.github.io/blog/2020/09/07/center-of-gravity-analysis.html&title=&summary=&source=');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"/></svg></div>

    <div class="twitter" title="Share this on Twitter" onclick="window.open('http://twitter.com/home?status=https://victorangeloblancada.github.io/blog/2020/09/07/center-of-gravity-analysis.html');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"/></svg></div>
    
    <div class="facebook" title="Share this on Facebook" onclick="window.open('http://www.facebook.com/share.php?u=https://victorangeloblancada.github.io/blog/2020/09/07/center-of-gravity-analysis.html');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z"/></svg></div>


    <!--<div class="pinterest" title="Share this on Pinterest" onclick="window.open('https://pinterest.com/pin/create/button/?url=&media=https://victorangeloblancada.github.io/assets/images/truck.jpg&description=');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M256 597q0-108 37.5-203.5t103.5-166.5 152-123 185-78 202-26q158 0 294 66.5t221 193.5 85 287q0 96-19 188t-60 177-100 149.5-145 103-189 38.5q-68 0-135-32t-96-88q-10 39-28 112.5t-23.5 95-20.5 71-26 71-32 62.5-46 77.5-62 86.5l-14 5-9-10q-15-157-15-188 0-92 21.5-206.5t66.5-287.5 52-203q-32-65-32-169 0-83 52-156t132-73q61 0 95 40.5t34 102.5q0 66-44 191t-44 187q0 63 45 104.5t109 41.5q55 0 102-25t78.5-68 56-95 38-110.5 20-111 6.5-99.5q0-173-109.5-269.5t-285.5-96.5q-200 0-334 129.5t-134 328.5q0 44 12.5 85t27 65 27 45.5 12.5 30.5q0 28-15 73t-37 45q-2 0-17-3-51-15-90.5-56t-61-94.5-32.5-108-11-106.5z"/></svg></div>-->

    <!--<div class="gplus" title="Share this on Google Plus" onclick="window.open('https://plus.google.com/share?url=https://victorangeloblancada.github.io/blog/2020/09/07/center-of-gravity-analysis.html');"><svg viewBox="0 0 2304 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1437 913q0 208-87 370.5t-248 254-369 91.5q-149 0-285-58t-234-156-156-234-58-285 58-285 156-234 234-156 285-58q286 0 491 192l-199 191q-117-113-292-113-123 0-227.5 62t-165.5 168.5-61 232.5 61 232.5 165.5 168.5 227.5 62q83 0 152.5-23t114.5-57.5 78.5-78.5 49-83 21.5-74h-416v-252h692q12 63 12 122zm867-122v210h-209v209h-210v-209h-209v-210h209v-209h210v209h209z"/></svg></div>-->

    <div class="mail" title="Share this through Email" onclick="window.open('mailto:?&body=https://victorangeloblancada.github.io/blog/2020/09/07/center-of-gravity-analysis.html');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 710v794q0 66-47 113t-113 47h-1472q-66 0-113-47t-47-113v-794q44 49 101 87 362 246 497 345 57 42 92.5 65.5t94.5 48 110 24.5h2q51 0 110-24.5t94.5-48 92.5-65.5q170-123 498-345 57-39 100-87zm0-294q0 79-49 151t-122 123q-376 261-468 325-10 7-42.5 30.5t-54 38-52 32.5-57.5 27-50 9h-2q-23 0-50-9t-57.5-27-52-32.5-54-38-42.5-30.5q-91-64-262-182.5t-205-142.5q-62-42-117-115.5t-55-136.5q0-78 41.5-130t118.5-52h1472q65 0 112.5 47t47.5 113z"/></svg></div>

</div>
						</div>
						
					</span>
				</div>
			</div>
			<div id="hero-img-spacer" style="height: 100vh;">
			</div>
			<div id="start">
			</div>
			<div class="content">
				
				<h1>Logistics Center of Gravity Analysis in Python</h1>
				
				<!--
				<h1> Logistics Center of Gravity Analysis in Python </h1>
				
				<p style="font-style:italic">September 07, 2020</p>
				
				-->
				<div class="article  dropcap ">
					<script type="text/javascript" async="" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML">
</script>

<p>In logistics, the center of gravity analysis is used to derive the ideal location for warehousing facilities by calculating the transport costs to each of the supply or demand locations to be served by the facility. The center of gravity is therefore the location giving the lowest total transport costs.</p>

<p>From its name, it can be inferred that the center of gravity analysis is analogous to the center of mass, its physics and engineering counterpart, where the center of mass is the single point where the weighted relative position of the distributed mass sums to zero. The formula is similarly analogous with the logistics center of gravity calculated using transport volumes to and from the warehousing facility instead of distributed mass as in the physical center of mass. The formula for the coordinates of the physical center of mass or the logistics center of gravity is thus:</p>

\[x = \frac{\sum_{i=1}^n m_i x_i }{\sum_{i=1}^n m_i}\]

\[y = \frac{\sum_{i=1}^n m_i y_i }{\sum_{i=1}^n m_i}\]

<p>Where x and y refer to the coordinates of the n locations served (coordinates of the n distributed mass points for the physical center of mass) and m refers to the delivery volume (mass for the physical center of mass).</p>

<p>However, applying this theoretical analysis to practical problems rapidly becomes complicated as realistic assumptions and business constraints are considered, such as:</p>

<ol>
  <li>What if there needs to be more than one warehousing facility location?</li>
  <li>What if the inbound and outbound shipping costs vary? This is a realistic assumption as inbound delivery costs tend to be lower since items are shipped by bulk to the warehouse and thus benefit from economies of scale while items are shipped out to customers or distributors in smaller quantities.</li>
  <li>What if the business only have a few candidate locations where they can set up the facility?</li>
  <li>How do we ensure that selected coordinates land on feasible sites for warehouse locations, e.g. the location is not in a residential area or on a mountain or on water?</li>
</ol>

<p>For questions 1 &amp; 2, we’ll look at how to use K-Means to get the centers of gravity. The following section includes code for implementing this in Python.</p>

<p>For questions 3 &amp; 4, we will then look at how to use <a href="https://docs.python.org/2/library/itertools.html">Itertools</a> in Python to select the centers of gravity from a set of candidate sites. The last section includes code for implementing this.</p>

<h2 id="using-k-means-for-multiple-facilities">Using K-Means for Multiple Facilities</h2>

<p>Let’s use the following dummy data to get the centers of gravity:</p>

<div class="dataframe">
<table>
  <thead>
    <tr>
      <th>Location Name</th>
      <th>Latitude</th>
      <th>Longitude</th>
      <th>Volume</th>
      <th>Location Type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Manhattan,  NY</td>
      <td>40.7831</td>
      <td>-73.9712</td>
      <td>5,000</td>
      <td>Demand</td>
    </tr>
    <tr>
      <td>New  Haven, CT</td>
      <td>41.2982</td>
      <td>-72.9991</td>
      <td>1,000</td>
      <td>Demand</td>
    </tr>
    <tr>
      <td>Chicago,  Il</td>
      <td>41.8333</td>
      <td>-88.0121</td>
      <td>4,000</td>
      <td>Demand</td>
    </tr>
    <tr>
      <td>Boston, MA</td>
      <td>42.3142</td>
      <td>-71.1103</td>
      <td>3,000</td>
      <td>Demand</td>
    </tr>
    <tr>
      <td>Raleigh,  NC</td>
      <td>35.8436</td>
      <td>-78.7851</td>
      <td>8,000</td>
      <td>Supply</td>
    </tr>
    <tr>
      <td>Nashville, TN</td>
      <td>36.1863</td>
      <td>-87.0654</td>
      <td>5,000</td>
      <td>Supply</td>
    </tr>
  </tbody>
</table>
</div>

<p>Suppose that we want to identify two warehouse locations using the center of gravity method. The center of mass formula from the previous section will only provide a single center of gravity, however, from its definition as the point where transport costs are minimized, we can use the K-means clustering algorithm to determine multiple locations that will minimize the transport costs as K-means clustering is an unsupervised learning technique that identifies centroids such that each individual data point is assigned a cluster based on which centroid is closest to it. To identify two warehouse locations, we can run the K-means clustering algorithm with K=2 to get two centroids that minimize the transport distances and therefore minimize the transport costs.</p>

<p>The code block below imports the necessary libraries for the analysis and loads the table above:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="c1"># Import libraries
</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span> 

<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>

<span class="kn">import</span> <span class="nn">folium</span>

<span class="c1"># Load data
</span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s">'Data.xlsx'</span><span class="p">,</span>
                     <span class="n">dtypes</span><span class="o">=</span><span class="p">{</span><span class="s">'Location Name'</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                             <span class="s">'Location Type'</span><span class="p">:</span> <span class="nb">str</span><span class="p">})</span>
</code></pre></div></div>

<p>The code block below uses Folium to plot the sites (red for demand sites and yellow for supply sites) on a Leaflet map:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Color options
</span><span class="n">color_options</span> <span class="o">=</span> <span class="p">{</span><span class="s">'demand'</span><span class="p">:</span> <span class="s">'red'</span><span class="p">,</span>
                 <span class="s">'supply'</span><span class="p">:</span> <span class="s">'yellow'</span><span class="p">,</span>
                 <span class="s">'flow'</span><span class="p">:</span> <span class="s">'black'</span><span class="p">,</span>
                 <span class="s">'cog'</span><span class="p">:</span> <span class="s">'blue'</span><span class="p">,</span>
                 <span class="s">'candidate'</span><span class="p">:</span> <span class="s">'black'</span><span class="p">,</span>
                 <span class="s">'other'</span><span class="p">:</span> <span class="s">'gray'</span><span class="p">}</span>

<span class="c1"># Instantiate map
</span><span class="n">m</span> <span class="o">=</span> <span class="n">folium</span><span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">data</span><span class="p">[[</span><span class="s">'Latitude'</span><span class="p">,</span> <span class="s">'Longitude'</span><span class="p">]].</span><span class="n">mean</span><span class="p">(),</span>
               <span class="n">fit_bounds</span><span class="o">=</span><span class="p">[[</span><span class="n">data</span><span class="p">[</span><span class="s">'Latitude'</span><span class="p">].</span><span class="nb">min</span><span class="p">(),</span>
                            <span class="n">data</span><span class="p">[</span><span class="s">'Longitude'</span><span class="p">].</span><span class="nb">min</span><span class="p">()],</span> 
                           <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s">'Latitude'</span><span class="p">].</span><span class="nb">max</span><span class="p">(),</span>
                            <span class="n">data</span><span class="p">[</span><span class="s">'Longitude'</span><span class="p">].</span><span class="nb">max</span><span class="p">()]])</span>
                            
<span class="c1"># Add volume points
</span><span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">folium</span><span class="p">.</span><span class="n">CircleMarker</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">'Latitude'</span><span class="p">],</span> 
                                  <span class="n">row</span><span class="p">[</span><span class="s">'Longitude'</span><span class="p">]],</span>
                        <span class="n">radius</span><span class="o">=</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">'Volume'</span><span class="p">]</span><span class="o">**</span><span class="mf">0.5</span><span class="p">),</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">color_options</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">'Location Type'</span><span class="p">]).</span><span class="n">lower</span><span class="p">(),</span> <span class="s">'gray'</span><span class="p">),</span>
                        <span class="n">tooltip</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">'Location Name'</span><span class="p">])</span><span class="o">+</span><span class="s">' '</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">'Volume'</span><span class="p">])).</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                                <span class="c1">#row['Longitude']]).add_to(m)
</span>        
<span class="c1"># Zoom based on volume points
</span><span class="n">m</span><span class="p">.</span><span class="n">fit_bounds</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="s">'Latitude'</span><span class="p">,</span> <span class="s">'Longitude'</span><span class="p">]].</span><span class="n">values</span><span class="p">.</span><span class="n">tolist</span><span class="p">())</span>

<span class="c1"># Show the map
</span><span class="n">m</span>
</code></pre></div></div>

<p><img src="/assets/images/cog_1.PNG" alt="img" /></p>

<p>Also suppose that the outbound and inbound shipping costs vary, with deliveries inbound to the warehouse generally costing less for a delivery of comparable distance from the warehouse, as they tend to do due to economies of scale. Suppose that outbound deliveries cost exactly twice as much as inbound deliveries. In this case, we need to scale the weights of the volumes accordingly. The outbound deliveries to demand locations are multiplied by two while the inbound deliveries from supply locations are kept the same:</p>

<div class="dataframe">
<table>
  <thead>
    <tr>
      <th>Location Name</th>
      <th>Latitude</th>
      <th>Longitude</th>
      <th>Volume</th>
      <th>Location Type</th>
      <th>Calc_Vol</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Manhattan,  NY</td>
      <td>40.7831</td>
      <td>-73.9712</td>
      <td>5,000</td>
      <td>Demand</td>
      <td>10,000</td>
    </tr>
    <tr>
      <td>New  Haven, CT</td>
      <td>41.2982</td>
      <td>-72.9991</td>
      <td>1,000</td>
      <td>Demand</td>
      <td>2,000</td>
    </tr>
    <tr>
      <td>Chicago,  Il</td>
      <td>41.8333</td>
      <td>-88.0121</td>
      <td>4,000</td>
      <td>Demand</td>
      <td>8,000</td>
    </tr>
    <tr>
      <td>Boston, MA</td>
      <td>42.3142</td>
      <td>-71.1103</td>
      <td>3,000</td>
      <td>Demand</td>
      <td>6,000</td>
    </tr>
    <tr>
      <td>Raleigh,  NC</td>
      <td>35.8436</td>
      <td>-78.7851</td>
      <td>8,000</td>
      <td>Supply</td>
      <td>8,000</td>
    </tr>
    <tr>
      <td>Nashville, TN</td>
      <td>36.1863</td>
      <td>-87.0654</td>
      <td>5,000</td>
      <td>Supply</td>
      <td>5,000</td>
    </tr>
  </tbody>
</table>
</div>

<p>The code block below adjusts the volumes from our raw data to account for the difference in costs between comparable inbound and outbound shipments:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># The outbound shipments cost twice as much as inbound shipments
</span><span class="n">IB_OB_ratio</span> <span class="o">=</span> <span class="mi">2</span>

<span class="k">def</span> <span class="nf">loc_type_mult</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="s">"""A function to get the volume multiplier based on the location type and the IB-OB ratio.
    x: The location type
    """</span>
    <span class="k">if</span> <span class="n">x</span><span class="p">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">'supply'</span><span class="p">:</span>
        <span class="c1"># No need to divide since we are already multiplying the demand
</span>        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">x</span><span class="p">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">'demand'</span><span class="p">:</span>
        <span class="c1"># Only apply multiplier to demand
</span>        <span class="k">return</span> <span class="n">IB_OB_ratio</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If neither supply nor demand, remove entirely
</span>        <span class="k">return</span> <span class="mi">0</span>

<span class="c1"># Adjust volumes used in the computation based on IB-OB ratio
</span><span class="n">data</span><span class="p">[</span><span class="s">'Calc_Vol'</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'Location Type'</span><span class="p">].</span><span class="nb">apply</span><span class="p">(</span><span class="nb">str</span><span class="p">).</span><span class="nb">apply</span><span class="p">(</span><span class="n">loc_type_mult</span><span class="p">)</span><span class="o">*</span><span class="n">data</span><span class="p">[</span><span class="s">'Volume'</span><span class="p">]</span>
</code></pre></div></div>

<p>The code block below uses Scikit-learn’s implementation of the K-means clustering algorithm to get two centroids as proposed warehouse locations:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Fit K-means for 2 centroids
</span><span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
                <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">).</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s">'Calc_Vol'</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="s">'Latitude'</span><span class="p">,</span> 
                                                                  <span class="s">'Longitude'</span><span class="p">]],</span> 
                                    <span class="n">sample_weight</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s">'Calc_Vol'</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> 
                                                           <span class="s">'Calc_Vol'</span><span class="p">])</span>
<span class="c1"># Get centers of gravity from K-means
</span><span class="n">cogs</span> <span class="o">=</span> <span class="n">kmeans</span><span class="p">.</span><span class="n">cluster_centers_</span>
<span class="n">cogs</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cogs</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'Latitude'</span><span class="p">,</span>
                                   <span class="s">'Longitude'</span><span class="p">])</span>

<span class="c1"># Get volume assigned to each cluster
</span><span class="n">data</span><span class="p">[</span><span class="s">'Cluster'</span><span class="p">]</span> <span class="o">=</span> <span class="n">kmeans</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="s">'Latitude'</span><span class="p">,</span> <span class="s">'Longitude'</span><span class="p">]])</span>
<span class="n">cogs</span> <span class="o">=</span> <span class="n">cogs</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'Cluster'</span><span class="p">)[</span><span class="s">'Volume'</span><span class="p">].</span><span class="nb">sum</span><span class="p">())</span>

<span class="c1"># Include assigned COG coordinates in data by point 
</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">cogs</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s">'Cluster'</span><span class="p">,</span> <span class="n">rsuffix</span><span class="o">=</span><span class="s">'_COG'</span><span class="p">)</span> 
</code></pre></div></div>

<p>The code block below plots the resulting centers of gravity using Folium on the Leaflet map, along with lines to indicate delivery routes from the proposed warehouse locations to the supply and demand sites:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Add flow lines to centers of gravity to map
</span><span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="c1"># Flow lines
</span>    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">'Location Type'</span><span class="p">]).</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">([</span><span class="s">'demand'</span><span class="p">,</span> <span class="s">'supply'</span><span class="p">]):</span>
        <span class="n">folium</span><span class="p">.</span><span class="n">PolyLine</span><span class="p">([(</span><span class="n">row</span><span class="p">[</span><span class="s">'Latitude'</span><span class="p">],</span>
                          <span class="n">row</span><span class="p">[</span><span class="s">'Longitude'</span><span class="p">]),</span>
                         <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">'Latitude_COG'</span><span class="p">],</span>
                          <span class="n">row</span><span class="p">[</span><span class="s">'Longitude_COG'</span><span class="p">])],</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">color_options</span><span class="p">[</span><span class="s">'flow'</span><span class="p">],</span>
                        <span class="n">weight</span><span class="o">=</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">'Volume'</span><span class="p">]</span><span class="o">**</span><span class="mf">0.5</span><span class="p">),</span>
                        <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">).</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                        
<span class="c1"># Add centers of gravity to map
</span><span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cogs</span><span class="p">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="c1"># New centers of gravity
</span>    <span class="n">folium</span><span class="p">.</span><span class="n">CircleMarker</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">'Latitude'</span><span class="p">],</span>
                                  <span class="n">row</span><span class="p">[</span><span class="s">'Longitude'</span><span class="p">]],</span>
                        <span class="n">radius</span><span class="o">=</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">'Volume'</span><span class="p">]</span><span class="o">**</span><span class="mf">0.5</span><span class="p">),</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">color_options</span><span class="p">[</span><span class="s">'cog'</span><span class="p">],</span>
                        <span class="n">tooltip</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s">'Volume'</span><span class="p">]).</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    
<span class="c1"># Show map
</span><span class="n">m</span>
</code></pre></div></div>

<p><img src="/assets/images/cog_2.PNG" alt="img" /></p>

<p>For the sample data, the algorithm appears to have selected to build the two warehouses near Urbana, Il and Wilmington, DE.</p>

<h2 id="using-itertools-to-iterate-across-combinations-of-sites">Using Itertools to Iterate Across Combinations of Sites</h2>

<p>What if there are a limited number of locations where the warehouse can be placed? This can be due to a number of factors: the company can already own existing plots of land, or they might want to avoid getting recommendations in residential areas.</p>

<p>We can vary our approach by introducing candidate sites for the algorithm to select the warehouse location from. In the table below, the raw data from the previous section has been updated with five candidate sites from which to choose two warehouse locations:</p>

<div class="dataframe">
<table>
  <thead>
    <tr>
      <th>Location Name</th>
      <th>Latitude</th>
      <th>Longitude</th>
      <th>Volume</th>
      <th>Location Type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Manhattan,  NY</td>
      <td>40.7831</td>
      <td>-73.9712</td>
      <td>5,000</td>
      <td>Demand</td>
    </tr>
    <tr>
      <td>New  Haven, CT</td>
      <td>41.2982</td>
      <td>-72.9991</td>
      <td>1,000</td>
      <td>Demand</td>
    </tr>
    <tr>
      <td>Chicago,  Il</td>
      <td>41.8333</td>
      <td>-88.0121</td>
      <td>4,000</td>
      <td>Demand</td>
    </tr>
    <tr>
      <td>Raleigh,  NC</td>
      <td>35.8436</td>
      <td>-78.7851</td>
      <td>8,000</td>
      <td>Supply</td>
    </tr>
    <tr>
      <td>Nashville, TN</td>
      <td>36.1863</td>
      <td>-87.0654</td>
      <td>5,000</td>
      <td>Supply</td>
    </tr>
    <tr>
      <td>Boston, MA</td>
      <td>42.3142</td>
      <td>-71.1103</td>
      <td>3,000</td>
      <td>Demand</td>
    </tr>
    <tr>
      <td>Charlottesville, VA</td>
      <td>38.04</td>
      <td>-78.5199</td>
      <td>&nbsp;</td>
      <td>Candidate</td>
    </tr>
    <tr>
      <td>Harrisburg, PA</td>
      <td>40.3394</td>
      <td>-77.0077</td>
      <td>&nbsp;</td>
      <td>Candidate</td>
    </tr>
    <tr>
      <td>Columbus, OH</td>
      <td>39.9828</td>
      <td>-83.1309</td>
      <td>&nbsp;</td>
      <td>Candidate</td>
    </tr>
    <tr>
      <td>Lafayette, IN</td>
      <td>40.4049</td>
      <td>-86.9282</td>
      <td>&nbsp;</td>
      <td>Candidate</td>
    </tr>
    <tr>
      <td>Buffalo, NY</td>
      <td>42.8962</td>
      <td>-78.9344</td>
      <td>&nbsp;</td>
      <td>Candidate</td>
    </tr>
  </tbody>
</table>
</div>
<p>The data preparation is mostly the same and is covered by the code block below to show the supply locations (yellow) and demand locations (red) along with the candidate sites (black) in the Leaflet map:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="c1"># Import libraries
</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span> 

<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>

<span class="kn">import</span> <span class="nn">folium</span>

<span class="c1"># Load data
</span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s">'Data.xlsx'</span><span class="p">,</span>
                     <span class="n">dtypes</span><span class="o">=</span><span class="p">{</span><span class="s">'Location Name'</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                             <span class="s">'Location Type'</span><span class="p">:</span> <span class="nb">str</span><span class="p">})</span>
                             
<span class="c1"># Color options
</span><span class="n">color_options</span> <span class="o">=</span> <span class="p">{</span><span class="s">'demand'</span><span class="p">:</span> <span class="s">'red'</span><span class="p">,</span>
                 <span class="s">'supply'</span><span class="p">:</span> <span class="s">'yellow'</span><span class="p">,</span>
                 <span class="s">'flow'</span><span class="p">:</span> <span class="s">'black'</span><span class="p">,</span>
                 <span class="s">'cog'</span><span class="p">:</span> <span class="s">'blue'</span><span class="p">,</span>
                 <span class="s">'candidate'</span><span class="p">:</span> <span class="s">'black'</span><span class="p">,</span>
                 <span class="s">'other'</span><span class="p">:</span> <span class="s">'gray'</span><span class="p">}</span>

<span class="c1"># Instantiate map
</span><span class="n">m</span> <span class="o">=</span> <span class="n">folium</span><span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">data</span><span class="p">[[</span><span class="s">'Latitude'</span><span class="p">,</span> <span class="s">'Longitude'</span><span class="p">]].</span><span class="n">mean</span><span class="p">(),</span>
               <span class="n">fit_bounds</span><span class="o">=</span><span class="p">[[</span><span class="n">data</span><span class="p">[</span><span class="s">'Latitude'</span><span class="p">].</span><span class="nb">min</span><span class="p">(),</span>
                            <span class="n">data</span><span class="p">[</span><span class="s">'Longitude'</span><span class="p">].</span><span class="nb">min</span><span class="p">()],</span> 
                           <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s">'Latitude'</span><span class="p">].</span><span class="nb">max</span><span class="p">(),</span>
                            <span class="n">data</span><span class="p">[</span><span class="s">'Longitude'</span><span class="p">].</span><span class="nb">max</span><span class="p">()]])</span>
                            
<span class="c1"># Add volume points
</span><span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">folium</span><span class="p">.</span><span class="n">CircleMarker</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">'Latitude'</span><span class="p">],</span> 
                                  <span class="n">row</span><span class="p">[</span><span class="s">'Longitude'</span><span class="p">]],</span>
                        <span class="n">radius</span><span class="o">=</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">'Volume'</span><span class="p">]</span><span class="o">**</span><span class="mf">0.5</span><span class="p">),</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">color_options</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">'Location Type'</span><span class="p">]).</span><span class="n">lower</span><span class="p">(),</span> <span class="s">'gray'</span><span class="p">),</span>
                        <span class="n">tooltip</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">'Location Name'</span><span class="p">])</span><span class="o">+</span><span class="s">' '</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">'Volume'</span><span class="p">])).</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                                <span class="c1">#row['Longitude']]).add_to(m)
</span>        
<span class="c1"># Zoom based on volume points
</span><span class="n">m</span><span class="p">.</span><span class="n">fit_bounds</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="s">'Latitude'</span><span class="p">,</span> <span class="s">'Longitude'</span><span class="p">]].</span><span class="n">values</span><span class="p">.</span><span class="n">tolist</span><span class="p">())</span>

<span class="c1"># Show the map
</span><span class="n">m</span>
</code></pre></div></div>

<p><img src="/assets/images/cog_3.PNG" alt="img" /></p>

<p>Same as in the previous section, the code block below adjusts the volumes from our raw data to account for the difference in costs between comparable inbound and outbound shipments:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># The outbound shipments cost twice as much as inbound shipments
</span><span class="n">IB_OB_ratio</span> <span class="o">=</span> <span class="mi">2</span>

<span class="k">def</span> <span class="nf">loc_type_mult</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="s">"""A function to get the volume multiplier based on the location type and the IB-OB ratio.
    x: The location type
    """</span>
    <span class="k">if</span> <span class="n">x</span><span class="p">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">'supply'</span><span class="p">:</span>
        <span class="c1"># No need to divide since we are already multiplying the demand
</span>        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">x</span><span class="p">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">'demand'</span><span class="p">:</span>
        <span class="c1"># Only apply multiplier to demand
</span>        <span class="k">return</span> <span class="n">IB_OB_ratio</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If neither supply nor demand, remove entirely
</span>        <span class="k">return</span> <span class="mi">0</span>

<span class="c1"># Adjust volumes used in the computation based on IB-OB ratio
</span><span class="n">data</span><span class="p">[</span><span class="s">'Calc_Vol'</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'Location Type'</span><span class="p">].</span><span class="nb">apply</span><span class="p">(</span><span class="nb">str</span><span class="p">).</span><span class="nb">apply</span><span class="p">(</span><span class="n">loc_type_mult</span><span class="p">)</span><span class="o">*</span><span class="n">data</span><span class="p">[</span><span class="s">'Volume'</span><span class="p">]</span>
</code></pre></div></div>

<p>The code block below shows a different way of solving for the centers of gravity. <a href="https://docs.python.org/2/library/itertools.html">Itertools</a> is used to loop through all possible combinations of warehouse locations to get the combination that will minimize transport costs. The code below calculates the total estimated transport costs based on distance weighted by relative transport costs for each combination of potential locations and saves the combination of locations that minimize this estimated cost:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cands</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s">'Location Type'</span><span class="p">].</span><span class="nb">str</span><span class="p">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s">'candidate'</span><span class="p">]</span>
<span class="n">locs</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s">'Calc_Vol'</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>

<span class="n">total_dist</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">inf</span>
<span class="n">best_cogs</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Loop to find best combination of candidate sites
</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">cands</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">n</span><span class="p">))):</span>
    <span class="n">temp_cands</span> <span class="o">=</span> <span class="n">cands</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>
    <span class="n">locs</span><span class="p">[</span><span class="s">'Cluster'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">locs</span><span class="p">[</span><span class="s">'Distance_COG'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">inf</span>
    <span class="k">for</span> <span class="n">i_l</span><span class="p">,</span> <span class="n">r_l</span> <span class="ow">in</span> <span class="n">locs</span><span class="p">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">i_c</span><span class="p">,</span> <span class="n">r_c</span> <span class="ow">in</span> <span class="n">temp_cands</span><span class="p">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="c1"># Get distance
</span>            <span class="n">dist</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_l</span><span class="p">[</span><span class="s">'Latitude'</span><span class="p">]</span><span class="o">-</span><span class="n">r_c</span><span class="p">[</span><span class="s">'Latitude'</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">dist</span> <span class="o">+=</span> <span class="p">(</span><span class="n">r_l</span><span class="p">[</span><span class="s">'Longitude'</span><span class="p">]</span><span class="o">-</span><span class="n">r_c</span><span class="p">[</span><span class="s">'Longitude'</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">dist</span> <span class="o">**=</span> <span class="mf">0.5</span>
            <span class="c1"># Save values if distance is shorter
</span>            <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">locs</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i_l</span><span class="p">,</span> <span class="s">'Distance_COG'</span><span class="p">]:</span>
                <span class="c1"># Save distance
</span>                <span class="n">locs</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i_l</span><span class="p">,</span> <span class="s">'Distance_COG'</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist</span>
                <span class="c1"># Save index of nearest point
</span>                <span class="n">locs</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i_l</span><span class="p">,</span> <span class="s">'Cluster'</span><span class="p">]</span> <span class="o">=</span> <span class="n">i_c</span>
    <span class="c1"># Weight distance by volume
</span>    <span class="n">locs</span><span class="p">[</span><span class="s">'Weighted_Distance_COG'</span><span class="p">]</span> <span class="o">=</span> <span class="n">locs</span><span class="p">[</span><span class="s">'Distance_COG'</span><span class="p">]</span> <span class="o">*</span> <span class="n">locs</span><span class="p">[</span><span class="s">'Calc_Vol'</span><span class="p">]</span>
    <span class="c1"># Save scenario if total weighted distance is smaller
</span>    <span class="k">if</span> <span class="n">locs</span><span class="p">[</span><span class="s">'Weighted_Distance_COG'</span><span class="p">].</span><span class="nb">sum</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">total_dist</span><span class="p">:</span>
        <span class="n">total_dist</span> <span class="o">=</span> <span class="n">locs</span><span class="p">[</span><span class="s">'Weighted_Distance_COG'</span><span class="p">].</span><span class="nb">sum</span><span class="p">()</span>
        <span class="n">best_cogs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

<span class="c1"># Get centers of gravity
</span><span class="n">cogs</span> <span class="o">=</span> <span class="n">cands</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">best_cogs</span><span class="p">,</span> <span class="p">[</span><span class="s">'Latitude'</span><span class="p">,</span>
                             <span class="s">'Longitude'</span><span class="p">]]</span>
<span class="c1"># Reloop to get site assignment
</span><span class="n">locs</span><span class="p">[</span><span class="s">'Cluster'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">locs</span><span class="p">[</span><span class="s">'Distance_COG'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">inf</span>
<span class="k">for</span> <span class="n">i_l</span><span class="p">,</span> <span class="n">r_l</span> <span class="ow">in</span> <span class="n">locs</span><span class="p">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i_c</span><span class="p">,</span> <span class="n">r_c</span> <span class="ow">in</span> <span class="n">cogs</span><span class="p">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="c1"># Get distance
</span>        <span class="n">dist</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_l</span><span class="p">[</span><span class="s">'Latitude'</span><span class="p">]</span><span class="o">-</span><span class="n">r_c</span><span class="p">[</span><span class="s">'Latitude'</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">dist</span> <span class="o">+=</span> <span class="p">(</span><span class="n">r_l</span><span class="p">[</span><span class="s">'Longitude'</span><span class="p">]</span><span class="o">-</span><span class="n">r_c</span><span class="p">[</span><span class="s">'Longitude'</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">dist</span> <span class="o">**=</span> <span class="mf">0.5</span>
        <span class="c1"># Save values if distance is shorter
</span>        <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">locs</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i_l</span><span class="p">,</span> <span class="s">'Distance_COG'</span><span class="p">]:</span>
            <span class="c1"># Save distance
</span>            <span class="n">locs</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i_l</span><span class="p">,</span> <span class="s">'Distance_COG'</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist</span>
            <span class="c1"># Save index of nearest point
</span>            <span class="n">locs</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i_l</span><span class="p">,</span> <span class="s">'Cluster'</span><span class="p">]</span> <span class="o">=</span> <span class="n">i_c</span>

<span class="c1"># Get volume assigned to each cog
</span><span class="n">cogs</span> <span class="o">=</span> <span class="n">cogs</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">locs</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'Cluster'</span><span class="p">)[</span><span class="s">'Volume'</span><span class="p">].</span><span class="nb">sum</span><span class="p">())</span>

<span class="c1"># Include assigned COG coordinates in data by point 
</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">locs</span><span class="p">[</span><span class="s">'Cluster'</span><span class="p">])</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">cogs</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s">'Cluster'</span><span class="p">,</span> <span class="n">rsuffix</span><span class="o">=</span><span class="s">'_COG'</span><span class="p">)</span> 
</code></pre></div></div>

<p>Similar to the previous section, the code block below plots the resulting centers of gravity using Folium on the Leaflet map, along with lines to indicate delivery routes from the proposed warehouse locations to the supply and demand sites:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Add flow lines to centers of gravity to map
</span><span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="c1"># Flow lines
</span>    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">'Location Type'</span><span class="p">]).</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">([</span><span class="s">'demand'</span><span class="p">,</span> <span class="s">'supply'</span><span class="p">]):</span>
        <span class="n">folium</span><span class="p">.</span><span class="n">PolyLine</span><span class="p">([(</span><span class="n">row</span><span class="p">[</span><span class="s">'Latitude'</span><span class="p">],</span>
                          <span class="n">row</span><span class="p">[</span><span class="s">'Longitude'</span><span class="p">]),</span>
                         <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">'Latitude_COG'</span><span class="p">],</span>
                          <span class="n">row</span><span class="p">[</span><span class="s">'Longitude_COG'</span><span class="p">])],</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">color_options</span><span class="p">[</span><span class="s">'flow'</span><span class="p">],</span>
                        <span class="n">weight</span><span class="o">=</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">'Volume'</span><span class="p">]</span><span class="o">**</span><span class="mf">0.5</span><span class="p">),</span>
                        <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">).</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                        
<span class="c1"># Add centers of gravity to map
</span><span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cogs</span><span class="p">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="c1"># New centers of gravity
</span>    <span class="n">folium</span><span class="p">.</span><span class="n">CircleMarker</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">'Latitude'</span><span class="p">],</span>
                                  <span class="n">row</span><span class="p">[</span><span class="s">'Longitude'</span><span class="p">]],</span>
                        <span class="n">radius</span><span class="o">=</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">'Volume'</span><span class="p">]</span><span class="o">**</span><span class="mf">0.5</span><span class="p">),</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">color_options</span><span class="p">[</span><span class="s">'cog'</span><span class="p">],</span>
                        <span class="n">tooltip</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s">'Volume'</span><span class="p">]).</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    
<span class="c1"># Show map
</span><span class="n">m</span>
</code></pre></div></div>

<p><img src="/assets/images/cog_4.PNG" alt="img" /></p>

<p>For the sample data, the algorithm has selected to build the two warehouses in Harrisburg, PA and in Lafayette, IN.</p>

<p><em>Victor Blancada is a data scientist. Visit his LinkedIn page <a href="https://www.linkedin.com/in/geloblancada/">here</a>.</em></p>

				</div>
				
				<div class="cta-box">
					

<style>
#share-buttons {display: inline-block; vertical-align: middle; }
#share-buttons:after {content: ""; display: block; clear: both;}
#share-buttons > div {
    position: relative;
    text-align: left; 
    height: 36px; 
    width: 32px; 
    float: left; 
    text-align: center;
}
#share-buttons > div > svg {height: 16px; fill: #FFF; margin-top: 10px;}
#share-buttons > div:hover {cursor: pointer;}
#share-buttons > div.facebook:hover > svg {fill: #3B5998;}
#share-buttons > div.twitter:hover > svg {fill: #55ACEE;}
#share-buttons > div.linkedin:hover > svg {fill: #0077b5;}
#share-buttons > div.pinterest:hover > svg {fill: #CB2027;}
#share-buttons > div.gplus:hover > svg {fill: #dd4b39;}
#share-buttons > div.mail:hover > svg {fill: #7D7D7D;}
#share-buttons > div.instagram:hover > svg {fill: #C73B92;}
#share-buttons > div.facebook > svg {height: 18px; margin-top: 9px;}
#share-buttons > div.twitter > svg {height: 20px; margin-top: 8px;}
#share-buttons > div.linkedin > svg {height: 19px; margin-top: 7px;}
#share-buttons > div.pinterest > svg {height: 20px; margin-top: 9px;}
#share-buttons > div.gplus > svg {height: 17px; margin-top: 9px; position: relative; left: 1px;}
#share-buttons > div.mail > svg {height: 14px; margin-top: 11px;}
</style>

<span>Share on: </span><div id="share-buttons">

    <div class="linkedin" title="Share this on Linkedin" onclick="window.open('https://www.linkedin.com/shareArticle?mini=true&url=https://victorangeloblancada.github.io/blog/2020/09/07/center-of-gravity-analysis.html&title=&summary=&source=');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"/></svg></div>

    <div class="twitter" title="Share this on Twitter" onclick="window.open('http://twitter.com/home?status=https://victorangeloblancada.github.io/blog/2020/09/07/center-of-gravity-analysis.html');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"/></svg></div>
    
    <div class="facebook" title="Share this on Facebook" onclick="window.open('http://www.facebook.com/share.php?u=https://victorangeloblancada.github.io/blog/2020/09/07/center-of-gravity-analysis.html');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z"/></svg></div>


    <!--<div class="pinterest" title="Share this on Pinterest" onclick="window.open('https://pinterest.com/pin/create/button/?url=&media=https://victorangeloblancada.github.io/assets/images/truck.jpg&description=');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M256 597q0-108 37.5-203.5t103.5-166.5 152-123 185-78 202-26q158 0 294 66.5t221 193.5 85 287q0 96-19 188t-60 177-100 149.5-145 103-189 38.5q-68 0-135-32t-96-88q-10 39-28 112.5t-23.5 95-20.5 71-26 71-32 62.5-46 77.5-62 86.5l-14 5-9-10q-15-157-15-188 0-92 21.5-206.5t66.5-287.5 52-203q-32-65-32-169 0-83 52-156t132-73q61 0 95 40.5t34 102.5q0 66-44 191t-44 187q0 63 45 104.5t109 41.5q55 0 102-25t78.5-68 56-95 38-110.5 20-111 6.5-99.5q0-173-109.5-269.5t-285.5-96.5q-200 0-334 129.5t-134 328.5q0 44 12.5 85t27 65 27 45.5 12.5 30.5q0 28-15 73t-37 45q-2 0-17-3-51-15-90.5-56t-61-94.5-32.5-108-11-106.5z"/></svg></div>-->

    <!--<div class="gplus" title="Share this on Google Plus" onclick="window.open('https://plus.google.com/share?url=https://victorangeloblancada.github.io/blog/2020/09/07/center-of-gravity-analysis.html');"><svg viewBox="0 0 2304 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1437 913q0 208-87 370.5t-248 254-369 91.5q-149 0-285-58t-234-156-156-234-58-285 58-285 156-234 234-156 285-58q286 0 491 192l-199 191q-117-113-292-113-123 0-227.5 62t-165.5 168.5-61 232.5 61 232.5 165.5 168.5 227.5 62q83 0 152.5-23t114.5-57.5 78.5-78.5 49-83 21.5-74h-416v-252h692q12 63 12 122zm867-122v210h-209v209h-210v-209h-209v-210h209v-209h210v209h209z"/></svg></div>-->

    <div class="mail" title="Share this through Email" onclick="window.open('mailto:?&body=https://victorangeloblancada.github.io/blog/2020/09/07/center-of-gravity-analysis.html');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 710v794q0 66-47 113t-113 47h-1472q-66 0-113-47t-47-113v-794q44 49 101 87 362 246 497 345 57 42 92.5 65.5t94.5 48 110 24.5h2q51 0 110-24.5t94.5-48 92.5-65.5q170-123 498-345 57-39 100-87zm0-294q0 79-49 151t-122 123q-376 261-468 325-10 7-42.5 30.5t-54 38-52 32.5-57.5 27-50 9h-2q-23 0-50-9t-57.5-27-52-32.5-54-38-42.5-30.5q-91-64-262-182.5t-205-142.5q-62-42-117-115.5t-55-136.5q0-78 41.5-130t118.5-52h1472q65 0 112.5 47t47.5 113z"/></svg></div>

</div>
				</div>
				
			</div>
			
			<center>
				<h2>Read more posts about...</h2>
				<ul class="tags">
					
						<a href='/blog/tag/logistics'><li> logistics </li></a>
					
						<a href='/blog/tag/python'><li> python </li></a>
					
						<a href='/blog/tag/combinations'><li> combinations </li></a>
					
						<a href='/blog/tag/itertools'><li> itertools </li></a>
					
						<a href='/blog/tag/kmeans'><li> kmeans </li></a>
					
						<a href='/blog/tag/clustering'><li> clustering </li></a>
					
				</ul>
				<a href='/blog.html'><p>See all posts</p></a>
			</center>
			
			<footer>
				<hr>
				© 2021 Victor Blancada. All Rights Reserved.
			</footer>
			<div class="spacer">
			</div>
		</div>
	</body>
</html>

